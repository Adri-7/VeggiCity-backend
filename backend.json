[
    {
        "id": "cf757416.97ca88",
        "type": "tab",
        "label": "VeggiCity API"
    },
    {
        "id": "c0c690e.17165f",
        "type": "subflow",
        "name": "getJardin",
        "info": "",
        "in": [
            {
                "x": 157.7777862548828,
                "y": 157.77780151367188,
                "wires": [
                    {
                        "id": "9cdff1d.e79931"
                    }
                ]
            }
        ],
        "out": [
            {
                "x": 1342.7777099609375,
                "y": 159.77781677246094,
                "wires": [
                    {
                        "id": "faa9fba7.275148",
                        "port": 0
                    }
                ]
            },
            {
                "x": 926,
                "y": 224,
                "wires": [
                    {
                        "id": "9f1a99bf.777d5",
                        "port": 0
                    },
                    {
                        "id": "678d577.6d055a8",
                        "port": 0
                    }
                ]
            }
        ]
    },
    {
        "id": "60ebfa82.7e48a4",
        "type": "subflow",
        "name": "getJardins",
        "info": "",
        "in": [
            {
                "x": 394,
                "y": 90,
                "wires": [
                    {
                        "id": "9196efb8.384d18"
                    }
                ]
            }
        ],
        "out": [
            {
                "x": 1015,
                "y": 85,
                "wires": [
                    {
                        "id": "6b9112f0.82fa84",
                        "port": 0
                    }
                ]
            }
        ]
    },
    {
        "id": "f5cdc70a.d1345",
        "type": "subflow",
        "name": "addMeasure",
        "info": "",
        "in": [
            {
                "x": 41,
                "y": 96,
                "wires": [
                    {
                        "id": "c8e006ee.497f98"
                    }
                ]
            }
        ],
        "out": [
            {
                "x": 929,
                "y": 441.75,
                "wires": [
                    {
                        "id": "f931511d.4df85",
                        "port": 0
                    }
                ]
            },
            {
                "x": 863,
                "y": 647,
                "wires": [
                    {
                        "id": "a461fffa.f50ae8",
                        "port": 0
                    },
                    {
                        "id": "838380de.374e6",
                        "port": 0
                    },
                    {
                        "id": "c82b306.bc21e5",
                        "port": 0
                    },
                    {
                        "id": "72c9cd89.45279c",
                        "port": 0
                    }
                ]
            }
        ]
    },
    {
        "id": "62b88822.e0ba48",
        "type": "subflow",
        "name": "getPlantation",
        "info": "",
        "in": [
            {
                "x": 91,
                "y": 160,
                "wires": [
                    {
                        "id": "166e797f.b7f407"
                    }
                ]
            }
        ],
        "out": [
            {
                "x": 1089,
                "y": 156,
                "wires": [
                    {
                        "id": "e4f1b4e5.b6d6e",
                        "port": 0
                    }
                ]
            },
            {
                "x": 668,
                "y": 251,
                "wires": [
                    {
                        "id": "51168cf2.bff47c",
                        "port": 0
                    },
                    {
                        "id": "80f6a353.a09678",
                        "port": 0
                    }
                ]
            }
        ]
    },
    {
        "id": "91bb539c.8c2b98",
        "type": "subflow",
        "name": "addPlantation",
        "info": "",
        "in": [
            {
                "x": 128,
                "y": 159,
                "wires": [
                    {
                        "id": "5f9ff481.be1e0c"
                    }
                ]
            }
        ],
        "out": [
            {
                "x": 1219,
                "y": 607,
                "wires": [
                    {
                        "id": "b471f9c.ad13588",
                        "port": 0
                    }
                ]
            },
            {
                "x": 999,
                "y": 876,
                "wires": [
                    {
                        "id": "ee9a2d27.c7cf48",
                        "port": 0
                    },
                    {
                        "id": "2d51b011.aada98",
                        "port": 0
                    },
                    {
                        "id": "13b5b784.85bf3",
                        "port": 0
                    },
                    {
                        "id": "ee2a8f6b.f8825",
                        "port": 0
                    },
                    {
                        "id": "9631ea9b.a38db",
                        "port": 0
                    },
                    {
                        "id": "1db8b31d.fe898d",
                        "port": 0
                    }
                ]
            }
        ]
    },
    {
        "id": "c0e93a6b.6b218",
        "type": "MySQLdatabase",
        "z": "",
        "host": "5.51.180.42",
        "port": "3306",
        "db": "veggicity",
        "tz": ""
    },
    {
        "id": "17557121.6b5617",
        "type": "http in",
        "z": "cf757416.97ca88",
        "name": "App API Server (GET)",
        "url": "/api/app",
        "method": "get",
        "swaggerDoc": "",
        "x": 214.5,
        "y": 330,
        "wires": [
            [
                "a7695812.f1ac8"
            ]
        ]
    },
    {
        "id": "b1ae170e.beb5e",
        "type": "http in",
        "z": "cf757416.97ca88",
        "name": "Sensors API Server",
        "url": "/api/sensor",
        "method": "post",
        "swaggerDoc": "",
        "x": 199.5,
        "y": 90,
        "wires": [
            [
                "caa219fc.8a0be"
            ]
        ]
    },
    {
        "id": "c18675e1.151718",
        "type": "http response",
        "z": "cf757416.97ca88",
        "name": "Server response",
        "x": 1494.27783203125,
        "y": 333.666748046875,
        "wires": []
    },
    {
        "id": "284a0285.11f016",
        "type": "template",
        "z": "cf757416.97ca88",
        "name": "Unkown method",
        "field": "error.message",
        "fieldType": "msg",
        "format": "text",
        "syntax": "plain",
        "template": "Unknown method.",
        "x": 775.8333740234375,
        "y": 409.6666259765625,
        "wires": [
            [
                "3d054af9.9d1426"
            ]
        ]
    },
    {
        "id": "a7695812.f1ac8",
        "type": "switch",
        "z": "cf757416.97ca88",
        "name": "Dispatch API method",
        "property": "payload.method",
        "propertyType": "msg",
        "rules": [
            {
                "t": "eq",
                "v": "getJardins",
                "vt": "str"
            },
            {
                "t": "eq",
                "v": "getJardin",
                "vt": "str"
            },
            {
                "t": "eq",
                "v": "getPlantation",
                "vt": "str"
            },
            {
                "t": "else"
            }
        ],
        "checkall": "false",
        "outputs": 4,
        "x": 493.5,
        "y": 330,
        "wires": [
            [
                "594cde33.5b3f78"
            ],
            [
                "d9ceda21.6b7e68"
            ],
            [
                "e764a94d.bb9be"
            ],
            [
                "284a0285.11f016"
            ]
        ]
    },
    {
        "id": "568149d7.fddb88",
        "type": "template",
        "z": "cf757416.97ca88",
        "name": "Build error message",
        "field": "payload",
        "fieldType": "msg",
        "format": "json",
        "syntax": "mustache",
        "template": "{\n    \"status\": \"error\",\n    \"message\": \"{{error.message}}\"\n}",
        "x": 1090.1666870117188,
        "y": 555,
        "wires": [
            [
                "f6aabc36.9a9aa"
            ]
        ]
    },
    {
        "id": "44d1a26b.89eb44",
        "type": "template",
        "z": "c0c690e.17165f",
        "name": "Build getJardin request",
        "field": "topic",
        "fieldType": "msg",
        "format": "handlebars",
        "syntax": "mustache",
        "template": "SELECT *\nFROM Jardin\nWHERE IdJardin = '{{{payload.id}}}';",
        "x": 976.2220458984375,
        "y": 157.6666259765625,
        "wires": [
            [
                "faa9fba7.275148"
            ]
        ]
    },
    {
        "id": "faa9fba7.275148",
        "type": "mysql",
        "z": "c0c690e.17165f",
        "mydb": "c0e93a6b.6b218",
        "name": "",
        "x": 1179.3333740234375,
        "y": 156.77780151367188,
        "wires": [
            []
        ]
    },
    {
        "id": "9cdff1d.e79931",
        "type": "switch",
        "z": "c0c690e.17165f",
        "name": "Jardin ID",
        "property": "payload.id",
        "propertyType": "msg",
        "rules": [
            {
                "t": "nnull"
            },
            {
                "t": "else"
            }
        ],
        "checkall": "true",
        "outputs": 2,
        "x": 470.6851501464844,
        "y": 162.11106872558594,
        "wires": [
            [
                "f4e04fe9.a5d898"
            ],
            [
                "9f1a99bf.777d5"
            ]
        ]
    },
    {
        "id": "9f1a99bf.777d5",
        "type": "template",
        "z": "c0c690e.17165f",
        "name": "Missing parameter",
        "field": "error.message",
        "fieldType": "msg",
        "format": "text",
        "syntax": "plain",
        "template": "ID parameter is missing.",
        "x": 776.148193359375,
        "y": 224.81488037109375,
        "wires": [
            []
        ]
    },
    {
        "id": "d9ceda21.6b7e68",
        "type": "subflow:c0c690e.17165f",
        "z": "cf757416.97ca88",
        "name": "",
        "x": 758.888916015625,
        "y": 277.6666564941406,
        "wires": [
            [
                "a6cb2200.99618"
            ],
            [
                "b6c00aca.52478"
            ]
        ]
    },
    {
        "id": "f4e04fe9.a5d898",
        "type": "assert",
        "z": "c0c690e.17165f",
        "name": "Check parameters",
        "rules": [
            {
                "property": "payload.id",
                "propertyType": "msg",
                "type": "regex",
                "value": "\\d+",
                "valueType": "str",
                "case": false
            }
        ],
        "x": 745.8889312744141,
        "y": 156.11111450195312,
        "wires": [
            [
                "44d1a26b.89eb44"
            ]
        ]
    },
    {
        "id": "a6cb2200.99618",
        "type": "function",
        "z": "cf757416.97ca88",
        "name": "Set JSON response doctype",
        "func": "if (msg.headers == null) {\n    msg.headers = [];\n}\nmsg.headers['Content-Type'] = 'application/json';\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "x": 1253.5,
        "y": 333,
        "wires": [
            [
                "c18675e1.151718"
            ]
        ]
    },
    {
        "id": "9196efb8.384d18",
        "type": "template",
        "z": "60ebfa82.7e48a4",
        "name": "Build getJardin request",
        "field": "topic",
        "fieldType": "msg",
        "format": "handlebars",
        "syntax": "mustache",
        "template": "SELECT *\nFROM Jardin;",
        "x": 639.5368957519531,
        "y": 87,
        "wires": [
            [
                "6b9112f0.82fa84"
            ]
        ]
    },
    {
        "id": "6b9112f0.82fa84",
        "type": "mysql",
        "z": "60ebfa82.7e48a4",
        "mydb": "c0e93a6b.6b218",
        "name": "",
        "x": 842.6482238769531,
        "y": 86.11117553710938,
        "wires": [
            []
        ]
    },
    {
        "id": "594cde33.5b3f78",
        "type": "subflow:60ebfa82.7e48a4",
        "z": "cf757416.97ca88",
        "x": 769.5,
        "y": 221,
        "wires": [
            [
                "a6cb2200.99618"
            ]
        ]
    },
    {
        "id": "f6aabc36.9a9aa",
        "type": "function",
        "z": "cf757416.97ca88",
        "name": "Set status code to error",
        "func": "msg.statusCode = 400;\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "x": 1341,
        "y": 555,
        "wires": [
            [
                "a6cb2200.99618"
            ]
        ]
    },
    {
        "id": "e754f0a9.086d2",
        "type": "catch",
        "z": "cf757416.97ca88",
        "name": "Catch generic errors",
        "scope": null,
        "x": 520.5,
        "y": 614,
        "wires": [
            [
                "5010ba9e.8d5ac4"
            ]
        ]
    },
    {
        "id": "5010ba9e.8d5ac4",
        "type": "template",
        "z": "cf757416.97ca88",
        "name": "Generic error message",
        "field": "error.message",
        "fieldType": "msg",
        "format": "text",
        "syntax": "plain",
        "template": "Internal server error.",
        "x": 830,
        "y": 611,
        "wires": [
            [
                "568149d7.fddb88"
            ]
        ]
    },
    {
        "id": "caa219fc.8a0be",
        "type": "subflow:f5cdc70a.d1345",
        "z": "cf757416.97ca88",
        "name": "",
        "x": 654,
        "y": 89,
        "wires": [
            [
                "a6cb2200.99618"
            ],
            [
                "617e96cc.a19c5"
            ]
        ]
    },
    {
        "id": "dc679df4.785a9",
        "type": "assert",
        "z": "f5cdc70a.d1345",
        "name": "Check measurement validity",
        "rules": [
            {
                "property": "payload.plantation",
                "propertyType": "msg",
                "type": "type",
                "value": "number"
            },
            {
                "property": "payload.temperature",
                "propertyType": "msg",
                "type": "type",
                "value": "number"
            },
            {
                "property": "payload.moisture",
                "propertyType": "msg",
                "type": "type",
                "value": "number"
            }
        ],
        "x": 572,
        "y": 95,
        "wires": [
            [
                "e4bd9c0e.2fe0d"
            ]
        ]
    },
    {
        "id": "f128c48c.176f9",
        "type": "comment",
        "z": "f5cdc70a.d1345",
        "name": "Check the existence of the plantation",
        "info": "",
        "x": 172.5,
        "y": 183.25,
        "wires": []
    },
    {
        "id": "3a786fb0.7c0ed",
        "type": "comment",
        "z": "f5cdc70a.d1345",
        "name": "Error output",
        "info": "",
        "x": 967.5,
        "y": 644,
        "wires": []
    },
    {
        "id": "95028bc8.7cfca",
        "type": "catch",
        "z": "f5cdc70a.d1345",
        "name": "Catch invalid input",
        "scope": [
            "dde679be.bf36d",
            "dc679df4.785a9"
        ],
        "x": 506.5,
        "y": 629,
        "wires": [
            [
                "a461fffa.f50ae8"
            ]
        ]
    },
    {
        "id": "5f0ab50a.1ba7e4",
        "type": "link in",
        "z": "cf757416.97ca88",
        "name": "",
        "links": [
            "617e96cc.a19c5",
            "b6c00aca.52478",
            "eca2e9c.44c4118",
            "cbc727b4.4700a",
            "3d054af9.9d1426"
        ],
        "x": 887.5,
        "y": 556,
        "wires": [
            [
                "568149d7.fddb88"
            ]
        ]
    },
    {
        "id": "617e96cc.a19c5",
        "type": "link out",
        "z": "cf757416.97ca88",
        "name": "addMeasure error output",
        "links": [
            "5f0ab50a.1ba7e4"
        ],
        "x": 786.5,
        "y": 136,
        "wires": []
    },
    {
        "id": "c8e006ee.497f98",
        "type": "assert",
        "z": "f5cdc70a.d1345",
        "name": "Check API method",
        "rules": [
            {
                "property": "req.query.method",
                "propertyType": "msg",
                "type": "eq",
                "value": "addMeasure",
                "valueType": "str"
            }
        ],
        "x": 241.5,
        "y": 94,
        "wires": [
            [
                "dc679df4.785a9"
            ]
        ]
    },
    {
        "id": "8662de51.76b34",
        "type": "catch",
        "z": "f5cdc70a.d1345",
        "name": "Catch invalid method",
        "scope": [
            "c8e006ee.497f98"
        ],
        "x": 498.5,
        "y": 670,
        "wires": [
            [
                "838380de.374e6"
            ]
        ]
    },
    {
        "id": "a461fffa.f50ae8",
        "type": "template",
        "z": "f5cdc70a.d1345",
        "name": "Invalid input",
        "field": "error.message",
        "fieldType": "msg",
        "format": "handlebars",
        "syntax": "plain",
        "template": "Invalid input: some required fields have been omitted or are not of type 'number'.",
        "x": 694,
        "y": 628,
        "wires": [
            []
        ]
    },
    {
        "id": "838380de.374e6",
        "type": "template",
        "z": "f5cdc70a.d1345",
        "name": "Invalid method",
        "field": "error.message",
        "fieldType": "msg",
        "format": "text",
        "syntax": "plain",
        "template": "Unknown API method.",
        "x": 705,
        "y": 672,
        "wires": [
            []
        ]
    },
    {
        "id": "2a3f77ab.ceb4a8",
        "type": "mysql",
        "z": "f5cdc70a.d1345",
        "mydb": "c0e93a6b.6b218",
        "name": "Look for a registered plantation",
        "x": 690.5,
        "y": 234,
        "wires": [
            [
                "e0e1217d.d42a"
            ]
        ]
    },
    {
        "id": "e4bd9c0e.2fe0d",
        "type": "change",
        "z": "f5cdc70a.d1345",
        "name": "Save data",
        "rules": [
            {
                "t": "move",
                "p": "payload",
                "pt": "msg",
                "to": "data",
                "tot": "msg"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 243.5,
        "y": 233,
        "wires": [
            [
                "a31046e7.399c58"
            ]
        ]
    },
    {
        "id": "a31046e7.399c58",
        "type": "template",
        "z": "f5cdc70a.d1345",
        "name": "Build request",
        "field": "topic",
        "fieldType": "msg",
        "format": "handlebars",
        "syntax": "mustache",
        "template": "SELECT COUNT(IdPlantation) as Found\nFROM Plantation\nWHERE IdPlantation = {{data.plantation}};",
        "x": 444.5,
        "y": 235,
        "wires": [
            [
                "2a3f77ab.ceb4a8"
            ]
        ]
    },
    {
        "id": "e0e1217d.d42a",
        "type": "assert",
        "z": "f5cdc70a.d1345",
        "name": "Ensure that the plantation exists",
        "rules": [
            {
                "property": "payload[0].Found",
                "propertyType": "msg",
                "type": "eq",
                "value": "1",
                "valueType": "str"
            }
        ],
        "x": 984.5,
        "y": 236,
        "wires": [
            [
                "5d39668c.4b95b8"
            ]
        ]
    },
    {
        "id": "4d195b1a.28db44",
        "type": "comment",
        "z": "f5cdc70a.d1345",
        "name": "Check request validity",
        "info": "",
        "x": 124.5,
        "y": 30,
        "wires": []
    },
    {
        "id": "f96ea93.08192d8",
        "type": "comment",
        "z": "f5cdc70a.d1345",
        "name": "Insert the data into the database",
        "info": "",
        "x": 156.5,
        "y": 369,
        "wires": []
    },
    {
        "id": "5d39668c.4b95b8",
        "type": "template",
        "z": "f5cdc70a.d1345",
        "name": "Build insert query",
        "field": "topic",
        "fieldType": "msg",
        "format": "handlebars",
        "syntax": "mustache",
        "template": "INSERT INTO Mesure (Temperature, Humidite, IdPlantation)\nVALUES ({{data.temperature}}, {{data.moisture}}, {{data.plantation}});",
        "x": 259.5,
        "y": 443,
        "wires": [
            [
                "8ed3d032.57b34",
                "7d6701df.21c7c8"
            ]
        ]
    },
    {
        "id": "ea54cc60.a2a608",
        "type": "catch",
        "z": "f5cdc70a.d1345",
        "name": "Catch DB error",
        "scope": [
            "8ed3d032.57b34",
            "2a3f77ab.ceb4a8"
        ],
        "x": 518.5,
        "y": 717,
        "wires": [
            [
                "c82b306.bc21e5"
            ]
        ]
    },
    {
        "id": "8ed3d032.57b34",
        "type": "mysql",
        "z": "f5cdc70a.d1345",
        "mydb": "c0e93a6b.6b218",
        "name": "Insert the new data",
        "x": 502.5,
        "y": 444,
        "wires": [
            [
                "f931511d.4df85"
            ]
        ]
    },
    {
        "id": "c82b306.bc21e5",
        "type": "template",
        "z": "f5cdc70a.d1345",
        "name": "DB error",
        "field": "error.message",
        "fieldType": "msg",
        "format": "text",
        "syntax": "plain",
        "template": "Database access error.",
        "x": 685,
        "y": 716,
        "wires": [
            []
        ]
    },
    {
        "id": "f931511d.4df85",
        "type": "template",
        "z": "f5cdc70a.d1345",
        "name": "Build success response",
        "field": "payload",
        "fieldType": "msg",
        "format": "json",
        "syntax": "plain",
        "template": "{\n    \"status\": \"success\"\n}",
        "x": 736.5,
        "y": 445,
        "wires": [
            []
        ]
    },
    {
        "id": "5dc9ce16.93b58",
        "type": "catch",
        "z": "f5cdc70a.d1345",
        "name": "Plantation does not exist",
        "scope": [
            "e0e1217d.d42a"
        ],
        "x": 489.5,
        "y": 761,
        "wires": [
            [
                "72c9cd89.45279c"
            ]
        ]
    },
    {
        "id": "72c9cd89.45279c",
        "type": "template",
        "z": "f5cdc70a.d1345",
        "name": "Unknown plantation",
        "field": "error.message",
        "fieldType": "msg",
        "format": "handlebars",
        "syntax": "plain",
        "template": "Plantation does not exist.",
        "x": 724,
        "y": 760,
        "wires": [
            []
        ]
    },
    {
        "id": "7d6701df.21c7c8",
        "type": "debug",
        "z": "f5cdc70a.d1345",
        "name": "",
        "active": true,
        "console": "false",
        "complete": "topic",
        "x": 461.5,
        "y": 513,
        "wires": []
    },
    {
        "id": "b6c00aca.52478",
        "type": "link out",
        "z": "cf757416.97ca88",
        "name": "addMeasure error output",
        "links": [
            "5f0ab50a.1ba7e4"
        ],
        "x": 868,
        "y": 300,
        "wires": []
    },
    {
        "id": "e764a94d.bb9be",
        "type": "subflow:62b88822.e0ba48",
        "z": "cf757416.97ca88",
        "x": 767.5,
        "y": 341,
        "wires": [
            [
                "a6cb2200.99618"
            ],
            [
                "eca2e9c.44c4118"
            ]
        ]
    },
    {
        "id": "eca2e9c.44c4118",
        "type": "link out",
        "z": "cf757416.97ca88",
        "name": "addMeasure error output",
        "links": [
            "5f0ab50a.1ba7e4"
        ],
        "x": 882,
        "y": 358,
        "wires": []
    },
    {
        "id": "65295668.c07b08",
        "type": "template",
        "z": "62b88822.e0ba48",
        "name": "Build getPlantation request",
        "field": "topic",
        "fieldType": "msg",
        "format": "handlebars",
        "syntax": "mustache",
        "template": "SELECT *\nFROM Plantation\nWHERE IdPlantation = '{{{payload.id}}}';",
        "x": 728.5368957519531,
        "y": 156,
        "wires": [
            [
                "e4f1b4e5.b6d6e"
            ]
        ]
    },
    {
        "id": "e4f1b4e5.b6d6e",
        "type": "mysql",
        "z": "62b88822.e0ba48",
        "mydb": "c0e93a6b.6b218",
        "name": "",
        "x": 953.648193359375,
        "y": 156.11117553710938,
        "wires": [
            []
        ]
    },
    {
        "id": "166e797f.b7f407",
        "type": "switch",
        "z": "62b88822.e0ba48",
        "name": "Plantation ID",
        "property": "payload.id",
        "propertyType": "msg",
        "rules": [
            {
                "t": "nnull"
            },
            {
                "t": "else"
            }
        ],
        "checkall": "true",
        "outputs": 2,
        "x": 223,
        "y": 160.44444274902344,
        "wires": [
            [
                "4af9db2b.ca1e4c"
            ],
            [
                "80f6a353.a09678"
            ]
        ]
    },
    {
        "id": "4af9db2b.ca1e4c",
        "type": "assert",
        "z": "62b88822.e0ba48",
        "name": "Check parameters",
        "rules": [
            {
                "property": "payload.id",
                "propertyType": "msg",
                "type": "regex",
                "value": "\\d+",
                "valueType": "str",
                "case": false
            }
        ],
        "x": 478.20379638671875,
        "y": 155.44448852539062,
        "wires": [
            [
                "65295668.c07b08"
            ]
        ]
    },
    {
        "id": "c98f5cd3.dacb98",
        "type": "catch",
        "z": "c0c690e.17165f",
        "name": "Catch wrong param",
        "scope": [
            "f4e04fe9.a5d898"
        ],
        "x": 561.5,
        "y": 272,
        "wires": [
            [
                "678d577.6d055a8"
            ]
        ]
    },
    {
        "id": "678d577.6d055a8",
        "type": "template",
        "z": "c0c690e.17165f",
        "name": "Invalid parameter",
        "field": "error.message",
        "fieldType": "msg",
        "format": "text",
        "syntax": "plain",
        "template": "ID parameter must be numeric.",
        "x": 777,
        "y": 272,
        "wires": [
            []
        ]
    },
    {
        "id": "80f6a353.a09678",
        "type": "template",
        "z": "62b88822.e0ba48",
        "name": "Missing parameter",
        "field": "error.message",
        "fieldType": "msg",
        "format": "text",
        "syntax": "plain",
        "template": "ID parameter is missing.",
        "x": 493,
        "y": 230,
        "wires": [
            []
        ]
    },
    {
        "id": "86010c90.83d338",
        "type": "catch",
        "z": "62b88822.e0ba48",
        "name": "Catch wrong param",
        "scope": [
            "4af9db2b.ca1e4c"
        ],
        "x": 278.351806640625,
        "y": 277.18511962890625,
        "wires": [
            [
                "51168cf2.bff47c"
            ]
        ]
    },
    {
        "id": "51168cf2.bff47c",
        "type": "template",
        "z": "62b88822.e0ba48",
        "name": "Invalid parameter",
        "field": "error.message",
        "fieldType": "msg",
        "format": "text",
        "syntax": "plain",
        "template": "ID parameter must be numeric.",
        "x": 493.851806640625,
        "y": 277.18511962890625,
        "wires": [
            []
        ]
    },
    {
        "id": "65b9efa2.89d6d8",
        "type": "http in",
        "z": "cf757416.97ca88",
        "name": "App API Server (POST)",
        "url": "/api/app",
        "method": "post",
        "swaggerDoc": "",
        "x": 213,
        "y": 470,
        "wires": [
            [
                "32d71a1.bcac766"
            ]
        ]
    },
    {
        "id": "32d71a1.bcac766",
        "type": "subflow:91bb539c.8c2b98",
        "z": "cf757416.97ca88",
        "x": 765.5,
        "y": 468,
        "wires": [
            [
                "a6cb2200.99618"
            ],
            [
                "cbc727b4.4700a"
            ]
        ]
    },
    {
        "id": "3751917a.301c36",
        "type": "assert",
        "z": "91bb539c.8c2b98",
        "name": "Check plantation data",
        "rules": [
            {
                "property": "payload.name",
                "propertyType": "msg",
                "type": "type",
                "value": "string"
            },
            {
                "property": "payload.date",
                "propertyType": "msg",
                "type": "type",
                "value": "string"
            },
            {
                "property": "payload.jardin",
                "propertyType": "msg",
                "type": "type",
                "value": "number"
            },
            {
                "property": "payload.species",
                "propertyType": "msg",
                "type": "type",
                "value": "number"
            }
        ],
        "x": 609.5,
        "y": 159,
        "wires": [
            [
                "58af2cdc.ef4b14"
            ]
        ]
    },
    {
        "id": "2bc05167.03ac2e",
        "type": "comment",
        "z": "91bb539c.8c2b98",
        "name": "Check the existence of the \"jardin\"",
        "info": "",
        "x": 227,
        "y": 248.25,
        "wires": []
    },
    {
        "id": "ba9c7b94.b8b638",
        "type": "comment",
        "z": "91bb539c.8c2b98",
        "name": "Error output",
        "info": "",
        "x": 1042,
        "y": 821,
        "wires": []
    },
    {
        "id": "60fae964.5f7bf",
        "type": "catch",
        "z": "91bb539c.8c2b98",
        "name": "Catch invalid input",
        "scope": [
            "dde679be.bf36d",
            "3751917a.301c36"
        ],
        "x": 578,
        "y": 783,
        "wires": [
            [
                "ee9a2d27.c7cf48"
            ]
        ]
    },
    {
        "id": "5f9ff481.be1e0c",
        "type": "assert",
        "z": "91bb539c.8c2b98",
        "name": "Check API method",
        "rules": [
            {
                "property": "req.query.method",
                "propertyType": "msg",
                "type": "eq",
                "value": "addPlantation",
                "valueType": "str"
            }
        ],
        "x": 306,
        "y": 159,
        "wires": [
            [
                "3751917a.301c36"
            ]
        ]
    },
    {
        "id": "8ef3941e.75d19",
        "type": "catch",
        "z": "91bb539c.8c2b98",
        "name": "Catch invalid method",
        "scope": [
            "5f9ff481.be1e0c"
        ],
        "x": 570,
        "y": 824,
        "wires": [
            [
                "2d51b011.aada98"
            ]
        ]
    },
    {
        "id": "ee9a2d27.c7cf48",
        "type": "template",
        "z": "91bb539c.8c2b98",
        "name": "Invalid input",
        "field": "error.message",
        "fieldType": "msg",
        "format": "handlebars",
        "syntax": "plain",
        "template": "Invalid input: some required fields have been omitted or are not of type 'number'.",
        "x": 765.5,
        "y": 782,
        "wires": [
            []
        ]
    },
    {
        "id": "2d51b011.aada98",
        "type": "template",
        "z": "91bb539c.8c2b98",
        "name": "Invalid method",
        "field": "error.message",
        "fieldType": "msg",
        "format": "text",
        "syntax": "plain",
        "template": "Unknown API method.",
        "x": 776.5,
        "y": 826,
        "wires": [
            []
        ]
    },
    {
        "id": "b5fca8f.c85c3d8",
        "type": "mysql",
        "z": "91bb539c.8c2b98",
        "mydb": "c0e93a6b.6b218",
        "name": "Look for a registered Jardin",
        "x": 745,
        "y": 299,
        "wires": [
            [
                "95050a68.516b38"
            ]
        ]
    },
    {
        "id": "d60ddd4a.0c7988",
        "type": "change",
        "z": "91bb539c.8c2b98",
        "name": "Save data",
        "rules": [
            {
                "t": "move",
                "p": "payload",
                "pt": "msg",
                "to": "data",
                "tot": "msg"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 308,
        "y": 298,
        "wires": [
            [
                "1153d2b3.b22a25"
            ]
        ]
    },
    {
        "id": "1153d2b3.b22a25",
        "type": "template",
        "z": "91bb539c.8c2b98",
        "name": "Build request",
        "field": "topic",
        "fieldType": "msg",
        "format": "handlebars",
        "syntax": "mustache",
        "template": "SELECT COUNT(IdJardin) as Found\nFROM Jardin\nWHERE IdJardin = {{data.jardin}};",
        "x": 509,
        "y": 300,
        "wires": [
            [
                "b5fca8f.c85c3d8"
            ]
        ]
    },
    {
        "id": "95050a68.516b38",
        "type": "assert",
        "z": "91bb539c.8c2b98",
        "name": "Ensure that the jardin exists",
        "rules": [
            {
                "property": "payload[0].Found",
                "propertyType": "msg",
                "type": "eq",
                "value": "1",
                "valueType": "str"
            }
        ],
        "x": 1052,
        "y": 298,
        "wires": [
            [
                "82ef108.c314cf"
            ]
        ]
    },
    {
        "id": "1eee29b7.b55abe",
        "type": "comment",
        "z": "91bb539c.8c2b98",
        "name": "Check request validity",
        "info": "",
        "x": 189,
        "y": 95,
        "wires": []
    },
    {
        "id": "579670db.4b88c8",
        "type": "comment",
        "z": "91bb539c.8c2b98",
        "name": "Insert the data into the database",
        "info": "",
        "x": 215,
        "y": 545,
        "wires": []
    },
    {
        "id": "1ec8f41e.b3519c",
        "type": "template",
        "z": "91bb539c.8c2b98",
        "name": "Build insert query",
        "field": "topic",
        "fieldType": "msg",
        "format": "handlebars",
        "syntax": "mustache",
        "template": "INSERT INTO Plantation (Nom, DatePlantation, IdJardin, IdEspece)\nVALUES (?, ?, ?, ?);",
        "x": 560,
        "y": 605,
        "wires": [
            [
                "6819daba.a6bc8c",
                "e601e97c.28a39"
            ]
        ]
    },
    {
        "id": "36acc43f.46d1dc",
        "type": "catch",
        "z": "91bb539c.8c2b98",
        "name": "Catch DB error",
        "scope": [
            "6819daba.a6bc8c",
            "b5fca8f.c85c3d8",
            "c9232d60.a50b3"
        ],
        "x": 590,
        "y": 871,
        "wires": [
            [
                "13b5b784.85bf3"
            ]
        ]
    },
    {
        "id": "6819daba.a6bc8c",
        "type": "mysql",
        "z": "91bb539c.8c2b98",
        "mydb": "c0e93a6b.6b218",
        "name": "Insert the new data",
        "x": 803,
        "y": 606,
        "wires": [
            [
                "b471f9c.ad13588"
            ]
        ]
    },
    {
        "id": "13b5b784.85bf3",
        "type": "template",
        "z": "91bb539c.8c2b98",
        "name": "DB error",
        "field": "error.message",
        "fieldType": "msg",
        "format": "text",
        "syntax": "plain",
        "template": "Database access error.",
        "x": 756.5,
        "y": 870,
        "wires": [
            []
        ]
    },
    {
        "id": "b471f9c.ad13588",
        "type": "template",
        "z": "91bb539c.8c2b98",
        "name": "Build success response",
        "field": "payload",
        "fieldType": "msg",
        "format": "json",
        "syntax": "plain",
        "template": "{\n    \"status\": \"success\"\n}",
        "x": 1037,
        "y": 607,
        "wires": [
            []
        ]
    },
    {
        "id": "29747f38.7cc5c",
        "type": "catch",
        "z": "91bb539c.8c2b98",
        "name": "Jardin does not exist",
        "scope": [
            "95050a68.516b38"
        ],
        "x": 572,
        "y": 915,
        "wires": [
            [
                "ee2a8f6b.f8825"
            ]
        ]
    },
    {
        "id": "ee2a8f6b.f8825",
        "type": "template",
        "z": "91bb539c.8c2b98",
        "name": "Unknown Jardin",
        "field": "error.message",
        "fieldType": "msg",
        "format": "handlebars",
        "syntax": "plain",
        "template": "Jardin ID does not exist.",
        "x": 775.5,
        "y": 914,
        "wires": [
            []
        ]
    },
    {
        "id": "e601e97c.28a39",
        "type": "debug",
        "z": "91bb539c.8c2b98",
        "name": "",
        "active": true,
        "console": "false",
        "complete": "topic",
        "x": 762,
        "y": 675,
        "wires": []
    },
    {
        "id": "a7e93fc2.1457a8",
        "type": "comment",
        "z": "91bb539c.8c2b98",
        "name": "Check the existence of the species",
        "info": "",
        "x": 224,
        "y": 372,
        "wires": []
    },
    {
        "id": "c9232d60.a50b3",
        "type": "mysql",
        "z": "91bb539c.8c2b98",
        "mydb": "c0e93a6b.6b218",
        "name": "Look for a registered species",
        "x": 554,
        "y": 424.75,
        "wires": [
            [
                "beaa99c0.e9f8b"
            ]
        ]
    },
    {
        "id": "82ef108.c314cf",
        "type": "template",
        "z": "91bb539c.8c2b98",
        "name": "Build request",
        "field": "topic",
        "fieldType": "msg",
        "format": "handlebars",
        "syntax": "mustache",
        "template": "SELECT COUNT(IdEspece) as Found\nFROM Espece\nWHERE IdEspece = {{data.species}};",
        "x": 308,
        "y": 425.75,
        "wires": [
            [
                "c9232d60.a50b3"
            ]
        ]
    },
    {
        "id": "beaa99c0.e9f8b",
        "type": "assert",
        "z": "91bb539c.8c2b98",
        "name": "Ensure that the species exists",
        "rules": [
            {
                "property": "payload[0].Found",
                "propertyType": "msg",
                "type": "eq",
                "value": "1",
                "valueType": "str"
            }
        ],
        "x": 861,
        "y": 423.75,
        "wires": [
            [
                "3014984e.0911e"
            ]
        ]
    },
    {
        "id": "603d82b1.2ea76c",
        "type": "catch",
        "z": "91bb539c.8c2b98",
        "name": "Species does not exist",
        "scope": [
            "beaa99c0.e9f8b"
        ],
        "x": 573,
        "y": 959,
        "wires": [
            [
                "9631ea9b.a38db"
            ]
        ]
    },
    {
        "id": "9631ea9b.a38db",
        "type": "template",
        "z": "91bb539c.8c2b98",
        "name": "Unknown species",
        "field": "error.message",
        "fieldType": "msg",
        "format": "handlebars",
        "syntax": "plain",
        "template": "Species ID does not exist.",
        "x": 783,
        "y": 959,
        "wires": [
            []
        ]
    },
    {
        "id": "cbc727b4.4700a",
        "type": "link out",
        "z": "cf757416.97ca88",
        "name": "addMeasure error output",
        "links": [
            "5f0ab50a.1ba7e4"
        ],
        "x": 892,
        "y": 475,
        "wires": []
    },
    {
        "id": "3d054af9.9d1426",
        "type": "link out",
        "z": "cf757416.97ca88",
        "name": "addMeasure error output",
        "links": [
            "5f0ab50a.1ba7e4"
        ],
        "x": 887,
        "y": 409,
        "wires": []
    },
    {
        "id": "58af2cdc.ef4b14",
        "type": "assert",
        "z": "91bb539c.8c2b98",
        "name": "Check date",
        "rules": [
            {
                "property": "payload.date",
                "propertyType": "msg",
                "type": "regex",
                "value": "^\\d\\d\\d\\d-(0[1-9]|1[012])-(0[1-9]|[12][0-9]|3[01])$",
                "valueType": "str",
                "case": false
            }
        ],
        "x": 832,
        "y": 159,
        "wires": [
            [
                "d60ddd4a.0c7988"
            ]
        ]
    },
    {
        "id": "612da98a.2d9dc",
        "type": "catch",
        "z": "91bb539c.8c2b98",
        "name": "Catch invalid date",
        "scope": [
            "58af2cdc.ef4b14"
        ],
        "x": 584,
        "y": 1007,
        "wires": [
            [
                "1db8b31d.fe898d"
            ]
        ]
    },
    {
        "id": "1db8b31d.fe898d",
        "type": "template",
        "z": "91bb539c.8c2b98",
        "name": "Wrong date",
        "field": "error.message",
        "fieldType": "msg",
        "format": "handlebars",
        "syntax": "plain",
        "template": "Date must follow the format YYYY-MM-DD.",
        "x": 764,
        "y": 1007,
        "wires": [
            []
        ]
    },
    {
        "id": "3014984e.0911e",
        "type": "change",
        "z": "91bb539c.8c2b98",
        "name": "Prepare query parameters",
        "rules": [
            {
                "t": "set",
                "p": "payload",
                "pt": "msg",
                "to": "[\t    msg.data.name,\t    msg.data.date,\t    msg.data.jardin,\t    msg.data.species\t]",
                "tot": "jsonata"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 315.5,
        "y": 605,
        "wires": [
            [
                "1ec8f41e.b3519c"
            ]
        ]
    }
]